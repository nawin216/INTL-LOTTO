<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password - INTL LOTTO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ฟอนต์ Prompt ให้หน้าดูเข้าชุดกับหน้าอื่น -->
  <link
    href="https://fonts.googleapis.com/css2?family=Prompt&display=swap"
    rel="stylesheet"
  />

  <!-- Flaticon UIcons สำหรับไอคอนรูปตา -->
  <link
    href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css"
    rel="stylesheet"
  />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Prompt', sans-serif;
      background: #e0e0e0;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 16px;
    }

    .container {
      width: 100%;
      max-width: 400px;
      background: white;
      padding: 24px 20px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    h2 {
      color: #29b6f6;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 22px;
    }

    .input-group {
      margin-top: 10px;
      text-align: left;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus {
      border-color: #29b6f6;
      box-shadow: 0 0 0 2px rgba(41,182,246,0.2);
    }

    /* หุ้มช่องรหัสให้วางไอคอนได้ */
    .password-wrapper {
      position: relative;
    }

    .password-wrapper input {
      padding-right: 40px; /* เผื่อพื้นที่ให้ไอคอนด้านขวา */
    }

    .eye-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 18px;
      color: #888;
      user-select: none;
    }

    .eye-icon:hover {
      color: #29b6f6;
    }

    button {
      margin-top: 18px;
      width: 100%;
      padding: 10px;
      background: #29b6f6;
      border: none;
      color: white;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      background: #1e9cd7;
    }

    .msg {
      margin-top: 12px;
      font-size: 14px;
      min-height: 18px;
    }

    a.back-link {
      display: inline-block;
      margin-top: 16px;
      color: #29b6f6;
      text-decoration: none;
      font-size: 14px;
    }

    a.back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<div class="container">
  <h2 data-i18n="resetTitle">Reset Password</h2>

  <div class="input-group">
    <input
      type="email"
      id="email"
      data-i18n-placeholder="resetEmailPlaceholder"
      placeholder="Email used for registration"
    >
  </div>

  <div class="input-group password-wrapper">
    <input
      type="password"
      id="newPassword"
      data-i18n-placeholder="resetNewPasswordPlaceholder"
      placeholder="New password"
    >
    <i class="fi fi-rr-eye-crossed eye-icon" onclick="togglePassword('newPassword', this)"></i>
  </div>

  <div class="input-group password-wrapper">
    <input
      type="password"
      id="confirmPassword"
      data-i18n-placeholder="resetConfirmPasswordPlaceholder"
      placeholder="Confirm new password"
    >
    <i class="fi fi-rr-eye-crossed eye-icon" onclick="togglePassword('confirmPassword', this)"></i>
  </div>

  <button onclick="resetPassword()" data-i18n="resetButton">
    Change Password
  </button>

  <div class="msg" id="message"></div>

  <a href="/" class="back-link" data-i18n="backToLogin">
    Back to login
  </a>
</div>

<script>
  // ---------- i18n dictionary ----------
  const i18n = {
    th: {
      resetTitle: "รีเซ็ตรหัสผ่าน",
      resetEmailPlaceholder: "อีเมลที่ใช้สมัคร",
      resetNewPasswordPlaceholder: "รหัสผ่านใหม่",
      resetConfirmPasswordPlaceholder: "ยืนยันรหัสผ่านใหม่",
      resetButton: "เปลี่ยนรหัสผ่าน",
      backToLogin: "กลับไปหน้าเข้าสู่ระบบ",

      fillAllFields: "กรุณากรอกข้อมูลให้ครบ",
      passwordMismatch: "รหัสผ่านใหม่และยืนยันรหัสผ่านไม่ตรงกัน",
      success: "เปลี่ยนรหัสผ่านสำเร็จแล้ว ✅",
      notFound: "ไม่พบอีเมลนี้ในระบบ",
      error: "เกิดข้อผิดพลาด"
    },
    en: {
      resetTitle: "Reset Password",
      resetEmailPlaceholder: "Email used for registration",
      resetNewPasswordPlaceholder: "New password",
      resetConfirmPasswordPlaceholder: "Confirm new password",
      resetButton: "Change Password",
      backToLogin: "Back to login",

      fillAllFields: "Please fill in all fields",
      passwordMismatch: "New password and confirmation do not match",
      success: "Password changed successfully ✅",
      notFound: "This email was not found in the system",
      error: "An error occurred"
    },
    zh: {
      resetTitle: "重置密码",
      resetEmailPlaceholder: "注册时使用的邮箱",
      resetNewPasswordPlaceholder: "新密码",
      resetConfirmPasswordPlaceholder: "确认新密码",
      resetButton: "修改密码",
      backToLogin: "返回登录页",

      fillAllFields: "请填写所有必填信息",
      passwordMismatch: "新密码和确认密码不一致",
      success: "密码修改成功 ✅",
      notFound: "系统中未找到此邮箱",
      error: "发生错误"
    }
  };

  let currentLang = "en";

  function t(key) {
    return (i18n[currentLang] && i18n[currentLang][key]) || key;
  }

  function applyTranslations() {
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      el.textContent = t(key);
    });

    document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
      const key = el.getAttribute("data-i18n-placeholder");
      el.placeholder = t(key);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const savedLang = localStorage.getItem("lang");
    if (savedLang && i18n[savedLang]) {
      currentLang = savedLang;
    }
    applyTranslations();
  });

  function togglePassword(inputId, iconEl) {
    const input = document.getElementById(inputId);
    if (!input) return;

    if (input.type === "password") {
      input.type = "text";
      iconEl.classList.remove("fi-rr-eye-crossed");
      iconEl.classList.add("fi-rr-eye");
    } else {
      input.type = "password";
      iconEl.classList.add("fi-rr-eye-crossed");
      iconEl.classList.remove("fi-rr-eye");
    }
  }

  async function resetPassword() {
    const email = document.getElementById("email").value.trim();
    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const msg = document.getElementById("message");

    msg.textContent = "";
    msg.style.color = "#e53935";

    if (!email || !newPassword || !confirmPassword) {
      msg.textContent = t("fillAllFields");
      return;
    }

    if (newPassword !== confirmPassword) {
      msg.textContent = t("passwordMismatch");
      return;
    }

    try {
      const res = await fetch("/api/auth/reset-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, newPassword })
      });

      const data = await res.json();

      if (res.ok) {
        msg.style.color = "#43a047";
        msg.textContent = t("success");
      } else {
        msg.textContent = data.message || t("error");
      }
    } catch (err) {
      console.error(err);
      msg.textContent = t("error");
    }
  }
</script>

</body>
</html>
